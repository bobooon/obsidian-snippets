.metadata-container {
  --metadata-gap: 0;
  --metadata-divider-width: 0;
  --metadata-properties-background: var(--background-primary-alt);
  --metadata-divider-color: var(--background-primary);
  --metadata-property-radius: var(--radius-m) !important;
  --metadata-property-radius-hover: var(--metadata-property-radius);
  --metadata-property-radius-focus: var(--metadata-property-radius);
}

.mod-sidedock .metadata-container {
  --metadata-properties-background: var(--mono-05);
  --metadata-divider-color: var(--mono-05);
}

.metadata-property {
  border: 1px solid transparent;
}

.metadata-property-icon::before {
  position: absolute;
}

.metadata-property-value {
  padding: 0 !important;
}

.multi-select-pill {
  padding-block: 0;

  .svg-icon {
    --icon-size: 10px;
  }
}

body:not(.no-property-pills),
.metadata-property[data-property-key="tags"] {
  .multi-select-container {
    gap: var(--size-2-2);
  }

  .multi-select-pill-content {
    padding-block: var(--size-2-2);
  }
}

.multi-select-pill-remove-button {
  margin-top: 1px;
}

body:not(.no-mono-numbers) .metadata-property-value {
  input[type="number"] {
    font-family: var(--font-monospace);
  }
}

body:not(.no-mono-dates) .metadata-property-value {
  input[type="date"],
  input[type="datetime-local"] {
    font-family: var(--font-monospace);
  }
}

.drag-reorder-ghost:has(> .metadata-property) {
  background-color: var(--mono-10);
  border-radius: var(--radius-m);

  > * {
    visibility: hidden;
  }
}

/**
 * Global container
 */
.metadata-container {
  margin: 0;

  .metadata-property-value {
    .metadata-input-text,
    .metadata-input-longtext,
    input[type="date"],
    input[type="datetime-local"],
    input[type="email"],
    input[type="number"],
    input[type="password"],
    input[type="search"],
    input[type="text"] {
      padding-inline: calc(var(--size-4-2) + 2px);
    }

    .metadata-input-checkbox {
      margin-inline: calc(var(--size-4-2) + 2px);
    }

    input[type="date"],
    input[type="datetime-local"] {
      margin-left: var(--size-2-2);
    }
  }

  @container (width < 330px) {
    .metadata-properties {
      gap: var(--size-4-2);
    }

    .metadata-property {
      flex-wrap: wrap;
    }

    .metadata-properties:not(:has(:focus, :focus-within)) .metadata-property {
      border-radius: 0;
    }

    .metadata-property-key {
      width: 100%;
      padding: var(--size-2-1) calc(var(--size-4-2) + 2px);
      border-bottom: 1px solid var(--background-modifier-border);

      .svg-icon {
        --icon-size: var(--icon-xs);
      }
    }

    .metadata-property:has(:focus-within) .metadata-property-key {
      border-bottom-color: transparent;
    }

    .metadata-property-key-input {
      padding: 0 0 0 var(--size-4-2);
    }

    .metadata-property-value {
      margin: 0;
      border-bottom: unset;

      input[type="date"],
      input[type="datetime-local"],
      input[type="email"],
      input[type="number"],
      input[type="password"],
      input[type="search"],
      input[type="text"] {
        height: var(--size-4-8);
      }

      .metadata-input-text,
      .metadata-input-longtext {
        padding-block: var(--size-4-2);
      }
    }

    .metadata-property-warning-icon {
      bottom: unset;
    }

    .multi-select-container {
      padding: var(--size-4-2);
    }

    .metadata-add-button {
      margin: var(--size-4-3) 0 0 var(--size-2-3);
    }
  }

  @container (width >= 330px) {
    .metadata-property-key {
      padding: var(--size-4-2) var(--size-4-3);

      .svg-icon {
        --icon-size: var(--icon-s);
      }
    }

    .multi-select-container {
      padding: var(--size-4-2) calc(var(--size-4-2) + 2px);
    }

    .metadata-add-button {
      margin: var(--size-2-3) 0 0 var(--size-4-2);
    }
  }
}

/**
 * Markdown container
 */
.workspace-tabs:has(.markdown-rendered) .metadata-container {
  transform: unset !important;

  &.is-collapsed {
    margin-bottom: var(--size-4-5);
    transition-duration: 100ms;
    transition-property: margin-bottom;
  }

  .metadata-properties-heading {
    display: inline-flex;
    align-items: center;
    padding: 0;
    margin: 0;
    transition-duration: var(--transition-fast);
    transition-property: padding;

    &:not(.is-collapsed) {
      padding-left: var(--size-4-4);
    }

    .collapse-indicator {
      position: static;
      order: 1;
      margin-top: -1px;

      &::before {
        content: unset;
      }
    }
  }

  .metadata-content {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .metadata-properties {
    width: 100%;
  }

  .metadata-properties-title,
  .metadata-add-button {
    font-size: var(--font-ui-smallest);
    color: var(--text-faint);
    text-transform: uppercase;
  }

  .metadata-add-button {
    margin-block: var(--size-4-3);
    background-color: var(--metadata-properties-background);

    &:is(:focus, :focus-within, :hover) {
      color: var(--text-muted);
    }
  }

  @container (width < 330px) {
    .metadata-property {
      background-color: var(--metadata-properties-background);
      border-radius: var(--radius-m) !important;

      &:last-child {
        border-bottom-color: transparent;
      }
    }

    .metadata-property-key {
      border-bottom-color: var(--metadata-divider-color);
    }
  }

  @container (width >= 330px) {
    .metadata-properties {
      background-color: var(--metadata-properties-background);
      border-radius: var(--metadata-property-radius);
    }

    .metadata-property {
      &:not(:first-child) {
        border-top-color: var(--metadata-divider-color);
      }

      &:not(:focus, :focus-within, :hover) {
        border-radius: 0;
      }

      &:is(:focus, :focus-within) {
        z-index: 11;
        border-color: var(--metadata-properties-background);
      }

      &:is(:focus, :focus-within, :hover),
      &:is(:focus, :focus-within, :hover) + .metadata-property {
        border-top-color: transparent !important;
      }
    }
  }
}

body.is-mobile .workspace-tabs:has(.markdown-rendered) .metadata-container .metadata-add-button {
  margin-bottom: var(--size-4-6);
}

/**
 * Minimize add property button
 */
body:not(.is-mobile, .no-min-add-property-button) {
  .workspace-tabs:has(.markdown-rendered) .metadata-container .metadata-add-button {
    position: relative;
    background-color: transparent;

    .svg-icon {
      --icon-size: var(--icon-xs);
    }

    &::before {
      position: absolute;
      inset: 0;
      height: var(--metadata-input-height);
      content: "";
      background-color: var(--mono-05);
      border-radius: var(--button-radius);
    }

    &::before,
    > span {
      transition-duration: var(--transition-fast);
      transition-property: height, opacity;
    }

    &:not(:focus, :focus-within, :hover) {
      &::before {
        height: 5px;
      }

      > span {
        opacity: 0;
      }
    }
  }

  &:not(.no-transition-delay) {
    .mod-root .metadata-container .metadata-add-button:is(:focus, :focus-within, :hover) {
      &::before,
      > span {
        transition-delay: var(--transition-delay-fast);
      }
    }
  }
}

/**
 * Pills
 */
body:not(.no-property-pills) .metadata-property:not([data-property-key="tags"]) {
  --pill-padding-y: var(--tag-padding-y);
  --pill-padding-x: var(--tag-padding-x);
  --pill-color: var(--text-muted);
  --pill-color-remove: var(--text-muted);
  --pill-color-remove-hover: var(--text-normal);
  --pill-weight: var(--tag-weight);
  --pill-decoration: var(--tag-decoration);
  --pill-decoration-hover: var(--tag-decoration-hover);
  --pill-background: var(--mono-05);
  --pill-background-hover: var(--mono-10);
  --pill-radius: var(--tag-radius);
  --pill-focus-width: 100%;
  --pill-focus-left-adjust: 0;

  --link-decoration: none !important;
  --link-decoration-hover: none !important;
  --link-external-decoration: none !important;
  --link-external-decoration-hover: none !important;

  .multi-select-pill {
    line-height: 1;
  }
}
